<!doctype html>
<html lang="en">
	<head>
		<script src="https://www.gstatic.com/firebasejs/5.1.0/firebase.js"></script>
		<script>
			firebase.initializeApp({apiKey: "AIzaSyAmAOqvqp7NbtJIEBlg2nDAh1BiYmJeTdk",authDomain: "qr-hall.firebaseapp.com",databaseURL: "https://qr-hall.firebaseio.com",projectId: "qr-hall",storageBucket: "qr-hall.appspot.com",messagingSenderId: "20691212546"});
			var url;
			firebase.database().ref('urls').on('value', function(snapshot) {
				//var keys = Object.keys(snapshot.val());
				url = snapshot.val()[ Object.keys(snapshot.val()).length * Math.random() << 0];
			});
			var startTime;
			var updateCountdown;
			document.onreadystatechange = function(){
			  if (document.readyState === 'interactive') {
			  	console.log("interactive");
			  	startTime = new Date();
			  	updateCountdown = setInterval(updateCountdownFunc,1);
			  	document.getElementById("redirect-div").addEventListener("click", function(){
					if(canceled){
					console.log("HEY");
						startTime -= 5000;
						updateCountdown = setInterval(updateCountdownFunc,1);
						document.getElementById("redirect-info").style.display = "block";
					}
				});
				//setTimeout( ()=>{}, 5);
			  }
			};
			var canceled = false;
			function skip(){
				startTime -= 5000;
			}
			function stop(){
				clearInterval(updateCountdown);
				document.getElementById("redirect-title").innerHTML = "Click Here to be Redirected!";
				setTimeout(function(){canceled = true;}, 5);
				document.getElementById("redirect-info").style.display = "none";
				document.getElementById("skip").style.display = "none";
				document.getElementById("stop").style.display = "none";
				console.log("DONE");
			}
			function updateCountdownFunc() {
			  		if((new Date()-startTime)<4000){
			  			document.getElementById("countdown").innerHTML = 5-((new Date()-startTime)/1000 << 0);
			  		}else{
			  			if((new Date()-startTime)>=5000){
			  				if(document.readyState === "complete"){
			  					if(url != null){
			  						//location.assign(url);
			  						document.getElementById("countdown-text").innerHTML = "You should have been redirected to: ";
			  						document.getElementById("redirect-link").innerHTML = url;
			  						document.getElementById("redirect-link").href = url;
			  						clearInterval(updateCountdown);
			  					}else{
			  						document.getElementById("countdown-text").innerHTML = "Hold on while we try to find were we kept that link...";
			  					}
			  				}else{
			  					document.getElementById("countdown-text").innerHTML = "So... apparently we still have to wait for THIS web page to load...";
			  				}
			  			}else{
			  				document.getElementById("countdown-text").innerHTML = "You are being redirected!";
			  			}
			  		}
			  	}
	  </script>
    <!--<meta http-equiv="refresh" content="0; URL='http://google.com'"/>-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>QR-In-The-Hall</title>
     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  	<!--<style>
	body, html {width: 100%; height: 100%; margin: 0; padding: 0}
	.first-row {position: absolute;top: 0; left: 0; right: 0; height: 100px; background-color: lime;}
	.second-row {position: absolute; top: 100px; left: 0; right: 0; bottom: 0;}
	.second-row iframe {display: block; width: 100%; height: 100%; border: none;}
  	</style>-->
  </head>
  <body>
  	<div id="redirect-div" class = "container-fluid">
  		<h3 id="redirect-title">You will be directed to an amazing page!</h3>
  		<div id="redirect-info">
			<p id="countdown-text" style="display:inline">In <span id="countdown">5</span> seconds...</p><a id="redirect-link"></a>
			<br>
			<small id="skip" onclick="skip()" style="color:blue;float: left;">SKIP</small>
			<small id="stop" onclick="stop()" style="color:red;float: right;">STOP</small>
  		</div>
  	</div>
  	<iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ"></iframe>
	<div class="first-row">
	  <p>Some text</p>
	  <p>And some more text</p>
	</div>
	<div class="second-row">
	</div>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  	<script>
	onload = function(){
		//setTimeout(function(){location.assign("https://www.google.com")}, 5);
	}
  	</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
  </body>
</html>